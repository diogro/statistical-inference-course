<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Bayesian Statistics I</title>
    <meta charset="utf-8" />
    <meta name="author" content="Diogo Melo" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy code <i class=\"fa fa-clipboard\"><\/i>","success":"Copied! <i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"Not copied ðŸ˜• <i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Bayesian Statistics I
]
.subtitle[
## Intro to Bayesian Thinking
]
.author[
### Diogo Melo
]
.date[
### 5 Fev 2024
]

---






class: inverse, center, middle
# Intro 

---

# Maximum Likelihood estimation

  - Up to this point we have been using the Maximum Likelihood principle
  - ML has many advantages:

    - General
    - (mostly) Automatic
    - Good theoretical justification
    - Good performance
    
---

# The Maximum Likelihood way

.pull-left[
   Given some data...

  `\(y = \{ y_1, \cdots, y_n \}\)`

  Define an observational model: 
  
  `\(P(y|\theta) = L_y(\theta)\)`

  Maximize the likelihood over the parameter space: 
  
  `\(\hat{\theta} =\underset{\theta \in \Omega}{\operatorname{arg max}} \left [ L_y(\theta) \right ]\)`
]
--

.pull-right[
  Any further inference uses this ML estimator:
  &lt;center&gt;

.bg-white.b--brblack.ba.bw2.br3.shadow-5.ph4.mt1[

  `\(\mu = f(\hat{\theta})\)`

  ]

  &lt;/center&gt;
]

---

# Log Likelihood surface

.center[

`\(y \sim Normal(\alpha + \beta x, \sigma)\)`

&lt;img src="../figures/logliksurface.png" width="50%" /&gt;
]
---

class: inverse, center, middle
# Bayes

---

# Rev Thomas Bayes (1701 â€“ 1761)


.center[
&lt;img src="../figures/Thomas_Bayes.png" width="50%" /&gt;
]

---

# Product rule (or Bayes Theorem)

.center[
$$
P(AB) = P(A|B)P(B) = P(B|A)P(A)
$$


&lt;img src="../figures/bayes_circles.png" width="50%" /&gt;

]

---

# What is Bayesian Statistics?

We can think of Bayesian Statistics as an extension of ML

- ML: What is the parameter value that maximizes the probability of having generated the data:
.bg-white.b--brblack.ba.bw2.br3.shadow-5.ph4.mt1[
  .center[
  `\(\underset{\theta \in \Omega}{\operatorname{arg max}} \left [ P(y|\theta) \right ]\)`
  ]
]

- Bayes: What is the probability distribution of parameter values given the data:
.bg-white.b--brblack.ba.bw2.br3.shadow-5.ph4.mt1[
  .center[
  `\(P(\theta|y) \propto P(\theta)P(y|\theta)\)`
  ]
]

---

# Probability Theory: The Logic of Science

.center[
&lt;img src="../figures/jaynes_book.jpeg" width="25%" /&gt;
]

By Edwin Thompson Jaynes 
(1922 â€“ 1998) 

---

# Statistical Rethinking 

.center[
&lt;img src="../figures/rethinking_book.jpg" width="25%" /&gt;
]

By Richard McElreath ([youtube.com/\@rmcelreath](https://www.youtube.com/@rmcelreath))

---

# Prior `\(\times\)` Likelihood `\(\propto\)` Posterior

.center[
&lt;img src="../figures/prior_likelihood.png" width="45%" /&gt;
]

---

# Why use the posterior?

- Allows us to use probability in more contexts

--

- `\(P(\theta|y)\)` represents our knowledge of parameters using probability 
  - this representation fully encapsulates our beliefs

--

- `\(P(\theta)\)`, the prior, can encode useful information
    - parameter scale, shared structure, permitted values...

--

- Isn't the MLE the best estimator? (depends on the criteria...)
  - Sometimes... but not `\(\mu = f(\hat{\theta})\)` 

--

- Expands the range of models we can fit

---

# Confidence intervals

.center[
&lt;img src="../figures/confidence_intervals.png" width="55%" /&gt;
]

---

# Nuisance variables

We can add additional variables that help to define the model but are not present in the posterior

$$
P(\theta|y) \propto \int P(\theta) P(y|\theta, \nu) d\nu
$$


---

class: inverse, center, middle
# Using the posterior

---

# Posterior estimators 

- Bayesian equivalent to MLE is the **M**aximum **A** **P**osteriori (MAP):

$$
\hat \theta^{MAP}  = \underset{\theta \in \Omega}{\operatorname{arg max}} \left [ P(\theta|y) \right ]
$$

- The posterior mean is more common:

.center[

`\(E_y[\theta]  = \sum_{\theta \in \Omega} \theta P(\theta|y)\)`

]

(Posterior median is also used occasionally.) 

---

# Posterior approximations

- For a small number of models we can write the posterior distribution directly (really small, don't bother).

- For most models, we use posterior samples to approximate the posterior.


`$$\{\theta_1, \cdots, \theta_N\} \sim P(\theta|y)$$`


---

# Posterior sample histogram

.center[
&lt;img src="../figures/posterior_samples.png" width="55%" /&gt;
]

---

# Posterior derived quantities 

This sample can be used to calculate any quantity of interest

.center[
`\(\{\theta_1, \cdots, \theta_N\} \sim P(\theta|y)\)`
]

For example, the posterior mean is just:

.center[
`\(\frac{\theta_1 + \theta_2 + \cdots + \theta_N}{N} \approx \sum_{\theta \in \Omega} \theta P(\theta|y)\)`
]

#### Other quantities

- Any other functions of the parameters can be estimated from the samples
- A common use is to calculate contrast between categorical levels, estimating the difference between groups

---

# Categorial predictors

We can also use categorical predictors to estimate per-group averages. 

- `\(K_i\)`: caloric content of milk in several monkey groups
- `\(CLADE\)`: categorical variable for the monkey groups

$$
`\begin{aligned}
  K_i &amp;\sim Normal(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha_{CLADE[i]} \\
  \alpha_i &amp;\sim Normal(0, 0.5) \\
  \sigma &amp;\sim Exponential(1)
\end{aligned}`
$$

---

# Per clade milk content

.center[
![](../figures/milk_model_coef.png)
]

---

# Contrasts

To compare coefficient estimates we must look at the distribution of differences

.center[
&lt;img src="../figures/milk_model_constrast.png" width="80%" /&gt;
]

---

class: inverse, center, middle
# Building a model

---

# My first bayesian regression model

.pull-left[
- Given the matched pairs:

`\((x, y) = \{ (x_1, y_1), \cdots, (x_n, y_n) \}\)`

- Define a likelihood:

`\(y_i \sim Normal(\mu_i, \sigma)\)`

`\(\mu_i = \alpha + \beta x_i\)`
]
--
.pull-right[
- And a set of priors on the parameters:

`\(\alpha \sim P(\alpha)\)`

`\(\beta \sim P(\beta)\)`

`\(\sigma \sim P(\sigma)\)`
]
---

# How do we choose the priors?

.pull-left[
- Agnostic choices
  - Laplace and the Principle of indifference
  - "Uninformative" priors
- Maximum entropy priors
  - priors that encode the least amount of information given constraints
- Jeffreys priors
  - invariant under a change of coordinates
- Hard constraints
  - restricted domains (e.g. variance must be positive)
]

--

.pull-right[
#### Good prior choices

- Use domain expertise!
  - Knowledge of scale (height `\(\sim\)` weight example)
  - Experimental design (more in the hierarchical models class)
  - Using simulations to understand the implications of priors
]

---

# Priors can be used to encode scale information

.center[
&lt;img src="../figures/height_weight_regression.png" width="50%" /&gt;
]

Adapted from Statistical Rethinking

---

# Wide prior 


.center[
&lt;img src="../figures/wide_prior.png" width="50%" /&gt;
]

This is sometimes called a non-informative prior

---

# Sensible prior

.center[
&lt;img src="../figures/sensible_prior.png" width="50%" /&gt;
]

This prior is informative, but in a good way!

---

# Our model for the height data

.pull-left[
$$
`\begin{aligned}
  y_i &amp;\sim Normal(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha + \beta x_i  \\
  \alpha &amp;\sim Normal(0, 20) \\
  \beta &amp;\sim lognormal(0, 1) \\
  \sigma &amp;\sim Exponential(1) 
\end{aligned}`
$$
]

.pull-right[

&lt;img src="../figures/height_weight_regression.png" width="95%" /&gt;

]

---

# Posterior samples

```python
&gt; samples
# A tibble: 2,000 Ã— 3
           a         b     sigma
   &lt;dbl[1d]&gt; &lt;dbl[1d]&gt; &lt;dbl[1d]&gt;
 1      115.     0.889      4.78
 2      109.     1.02       5.30
 3      112.     0.928      5.07
 4      111.     0.949      5.30
 5      111.     0.955      5.04
 6      115.     0.872      5.19
 7      109.     1.01       5.13
 8      117.     0.844      5.00
 9      115.     0.882      4.94
10      112.     0.939      4.95
# â€¦ with 1,990 more rows
```

#### Posterior mean estimates

```r
&gt; colMeans(samples)
          a           b       sigma 
112.9296580   0.9253803   5.0453651 
```

---

# Model fit

.center[
![](../figures/height_weight_fit.png)
]

---

# Posterior parameter distribution

.center[
![](../figures/height_weight_posteriors.png)
]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
